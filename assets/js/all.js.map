{"version":3,"sources":["all.js"],"names":["apiPath","token","orderData","orderList","document","querySelector","init","getOrderList","renderC3","obj","forEach","item","productItem","products","productItems","title","undefined","price","quantity","rank","Object","entries","sort","a","b","length","otherTotal","index","splice","push","console","log","chart","c3","generate","bindto","data","type","columns","color","pattern","axios","get","headers","then","response","orders","str","productStr","timeStamp","Date","createdAt","createdTime","getFullYear","getMonth","getDate","orderStatus","paid","id","user","name","tel","address","email","innerHTML","addEventListener","e","preventDefault","targetBtn","target","getAttribute","itemId","itemStatus","changeOrderStatus","deleteOrderItem","newItemStatus","put","alert","discardAllBtn","error"],"mappings":"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","file":"all.js","sourcesContent":["// 載入資料庫、金鑰、環境變數\nconst apiPath = \"ryanchiangfinaleaxam\";\nconst token = \"Jsbl8ongs9P32p2iKyLykEVQxcG2\";\n\nlet orderData = []; // 用來儲存需要用到的資料\nconst orderList = document.querySelector(\".orderList\"); //選取表單內容\n\n// 初始化\nfunction init(){\n    getOrderList();\n}\ninit();\n\n// 圓餅圖\nfunction renderC3(){\n    let obj = {};\n    // LV1\n    orderData.forEach(function(item){\n        let productItem = item.products;\n        productItem.forEach(function(productItems){\n            if(obj[productItems.title]==undefined){\n                obj[productItems.title]=productItems.price*productItems.quantity;\n            }else{\n                obj[productItems.title]+=productItems.price*productItems.quantity;\n            }\n        })\n    });\n    \n    // LV2\n    // 依營收重新排列品項\n    let rank = Object.entries(obj)\n    rank.sort(function(a, b){\n    return b[1] - a[1];\n    })\n    \n    if(rank.length>3){\n        let otherTotal = 0;\n        rank.forEach(function(item, index){\n            if(index>2){\n                otherTotal+=rank[index][1];\n            }\n        })\n        rank.splice(3, rank.length-1);\n        rank.push([\"其他\", otherTotal])\n    }\n    console.log(rank);\n    // 生成 c3 圖表\n    let chart = c3.generate({\n        bindto: '#chart', // HTML 元素綁定\n        data: {\n            type: \"donut\",\n            columns: rank,\n        },\n        color:{\n            pattern:[\"#301E5F\",\"#5434A7\", \"#9D7FEA\", \"#DACBFF\"]\n        }\n    });\n}\n\n// 取得表單資料\nfunction getOrderList(){\n    // 接使用者 API 路徑及金鑰\n    axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${apiPath}/orders`, \n        {headers:{\"authorization\": token}\n    })\n    .then (function(response){\n        orderData = response.data.orders;\n        // 訂單管理\n        let str = \"\";\n        orderData.forEach(function(item){\n\n            // 訂單品項處理\n            let productStr = \"\";\n            let productItem = item.products;\n            productItem.forEach(function(productItems){\n                productStr+=`<p>${productItems.title} *${productItems.quantity}</p>`\n            })\n\n            // 時間狀態處理\n            const timeStamp = new Date(item.createdAt*1000); // new Date 語法只支援 13碼，要把時間戳從 10 碼轉成 13 碼>>直接 *1000\n            let createdTime = `${timeStamp.getFullYear()}/${timeStamp.getMonth()+1}/${timeStamp.getDate()}`;\n\n            // 訂單狀態處理\n            let orderStatus = \"\";\n            if(item.paid==true){\n                orderStatus=\"已處理\";\n            }else if(item.paid==false){\n                orderStatus=\"未處理\";\n            }else{\n                orderStatus=\"狀態錯誤\";\n            }\n            // 訂單資訊組合\n            str+=\n                `<tr>\n                    <td>${item.id}</td>\n                    <td>\n                        <p>${item.user.name}</p>\n                        <p>${item.user.tel}</p>\n                    </td>\n                    <td>${item.user.address}</td>\n                    <td>${item.user.email}</td>\n                    <td>\n                        <p>${productStr}</p>\n                    </td>\n                    <td>${createdTime}</td>\n                    <td>\n                        <a href=\"#\" class=\"orderStatus\" data-status=\"${item.paid}\" data-id=\"${item.id}\">${orderStatus}</a>\n                    </td>\n                    <td>\n                        <input type=\"button\" class=\"delSingleOrder-Btn orderDelete\" value=\"刪除\" data-id=\"${item.id}\">\n                    </td>\n                </tr>`\n        })\n        orderList.innerHTML = str;\n        renderC3();\n    })\n}\n\n// 監聽表單 tbody 中的按鈕事件：1.訂單狀態 2.刪除\norderList.addEventListener(\"click\", function(e){\n    e.preventDefault(); //防跳轉至頂\n\n    // 設定觸發條件：以按鈕的 class 判斷點到哪個按鈕\n    const targetBtn = e.target.getAttribute(\"class\");\n    // 設定資料庫要回傳的資料條件\n    const itemId = e.target.getAttribute(\"data-id\")\n    const itemStatus = e.target.getAttribute(\"data-status\");\n    \n    // 1. 點到訂單狀態按鈕：觸發修改訂單狀態\n    if(targetBtn==\"orderStatus\"){\n        changeOrderStatus(itemStatus, itemId);\n    }\n    // 2. 點到刪除按鈕：觸發刪除單筆資料\n    else if(targetBtn==\"delSingleOrder-Btn orderDelete\"){\n        deleteOrderItem(itemId);\n    }\n\n})\n\n// 修改訂單狀態\nfunction changeOrderStatus(itemStatus, itemId){\n    //狀態切換條件\n    let newItemStatus;\n    if(itemStatus!=true){\n        newItemStatus=true;\n    }else{\n        newItemStatus=false;\n    };\n    \n    axios.put(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${apiPath}/orders`, \n        {\n            \"data\": {\n            \"id\": itemId,\n            \"paid\": newItemStatus,\n            },\n        },\n        {\n            headers:{\"authorization\": token},\n        })\n    .then(function(response){\n        alert(\"變更成功\");\n        getOrderList();\n    })\n}\n\n// 刪除單筆資料\nfunction deleteOrderItem(itemId){\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${apiPath}/orders/${itemId}`, \n        {headers:{\"authorization\": token}\n    })\n    .then(function(response){\n        alert(\"刪除成功\");\n        getOrderList();\n    })\n}\n\n// 刪除全部資料\nconst discardAllBtn = document.querySelector(\".discardAllBtn\");\ndiscardAllBtn.addEventListener(\"click\", function(e){\n    e.preventDefault();\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${apiPath}/orders`, \n        {headers:{\"authorization\": token}\n            })\n    .then(function(response){\n        alert(\"全部刪除成功\");\n        getOrderList();\n    })\n    .catch(function(error){\n        alert(\"已無訂單\");\n    })\n})\n\n"]}